# 需求文档：仓库调配策略算法

## 1. 项目概述

本项目的目标是开发一个调配策略算法，用于确定从多个仓库分配商品到多个订单的最优策略。每个仓库和订单都有相应的优先级，并需要在满足各种约束条件的前提下进行调配。输入数据包括仓库-订单的单位运输时间矩阵，订单的需求数量数组，以及仓库-商品现有量矩阵。输出数据为仓库-订单的运输量矩阵和运输时间矩阵。

### 2. 输入/输出

#### 2.1 输入

- 单位运输时间三维矩阵 $X_{m \times n \times l}$: 表示每种商品从每个仓库到每个订单的单位运输时间（小时/量纲）。
- 需求量矩阵 $Y_{m \times l}$: 显示每个订单对每种商品（量纲）的需求。
- 库存矩阵 $Z_{n \times l}$: 提供每个仓库中每种商品（量纲）的库存。
- 订单优先级矩阵 $O_{m}$: 表示每个订单的优先级（无单位）。
- 仓库优先级矩阵 $W_{n}$: 表示每个仓库的优先级（无单位）。

注：m表示订单数量，n表示仓库数量，l表示商品种类数量。

#### 2.2 输出

- 运输量三维矩阵 $A_{m \times n \times l}$: 表示每种商品从每个仓库到每个订单的运输量（量纲）。
- 运输时间三维矩阵 $B_{m \times n \times l}$: 表示每种商品从每个仓库到每个订单的运输时间（小时）。
- 运输时间矩阵与运输量矩阵和单位运输时间矩阵有关，即 $B_{m \times n \times l} = A_{m \times n \times l} \circ X_{m \times n \times l}$




## 3. 约束条件

- 运输量需在现有量和需求量之间，即：0 <= 运输量 <= 现有量 和 0 <= 运输量 <= 需求量
- 同一个仓库是否可以同时满足多个订单
- 运输时间总量 <= 最晚时间 - 当前时间

形式化地，有以下约束条件：
 对于所有的j和l，有 $0 \leq \sum_{i=1}^{m} a_{ijl} \leq z_{jl}$
 对于所有的i和l，有 $0 \leq \sum_{j=1}^{n} a_{ijl} \leq y_{il}$





## 4. 分配规则

- 输入中只有一种商品
- 仓库和订单是多对多关系
- 订单不会都满足（给定的需求数量已经乘以满足度系数，但可能还无法满足，此时能分多少分多少，库存分完为止）
- 仓库顺序和订单顺序对应其优先级（算法给两种实现，1是严格参照优先级，2是优先考虑最短运输时间，3是考虑优先级和最短运输时间的权衡。通过配置文件）
- 运输时间为cost，不考虑出库时间，以及其它cost

## 5. 目标函数

- 总体满意度（优先级权重）
- 最短运输时间
- 混合版本（手动配置）
  
  形式化地，目标是最大化以下目标函数：

\[
\text{Maximize } Z = \alpha \cdot k \cdot \left( \sum_{i=1}^{m} O_i \cdot \left( \sum_{l=1}^{L} \frac{\sum_{j=1}^{n} a_{ijl} \cdot W_j}{y_{il}} \right) \right) - \beta \cdot \left( \max_{i=1}^{m} \sum_{j=1}^{n} \sum_{l=1}^{L} b_{ijl} \right)
\]

其中 $\alpha + \beta = 1$。这里，k是一个单位为时间的常数，用来平衡总满意度（第一项）和最大运输时间（第二项）。

## 6. 未来要实现的功能

- 多商品
- 时间维度：实时变化的库存，出库时间冲突。

## 7. JSON数据示例

### 7.1 输入示例

```
{
	"spdd":[
		{
			"ddnm":"", //订单内码
			"qynm":"", //企业内码
			"

spnm":"", //商品内码
			"sl":1,    //数量
			"lg":"",   //量纲
			"ckdata":[
				{
					"cknm":"",   //仓库内码
					"dwyssj":3.0 //单位运输时间
				},
				{
					"cknm":"",
					"dwyssj":3.0
				}
			]
		}
	],
	"ck":[
		{"cknm1":
			[{"spnm":"","sl":10,"lg":"枚"},{"spnm":"","sl":10,"lg":"枚"},{"spnm":"","sl":10,"lg":"枚"},{"spnm":"","sl":10,"lg":"枚"}]},
		{"cknm2":
			[{"spnm":"","sl":10,"lg":"枚"},{"spnm":"","sl":10,"lg":"枚"},{"spnm":"","sl":10,"lg":"枚"},{"spnm":"","sl":10,"lg":"枚"}]}
	]
}
```

### 7.2 输出示例

```
{
	"code":200,
	"data":[
		{
			"ddnm":"",
			"cknm":"",
			"qynm":"",
			"spnm":"",
			"sl":1,
			"lg":"枚",
			"dpsj":3.0 //调配时间=出库时间（恒为0）+运输时间
		}
	]
}
```
