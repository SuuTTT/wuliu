## 介绍

本需求文档是甲方提供的需求原材料


## 用户需求

对用户需求的描述，包括功能需求和性能需求。

接口名称: sptp/ckylcxByTwsj
接口功能:基于天文时间进行仓库余量查询
请求方式:POST
请求参数:｛spxqxx:{[{“spnm":“xx”, “zwkssj
:“2023-06-06 12:00:09"}]}

String spnm 商品内码
Date zwkssj 最晚开始时间(用订单需求时间减去调配成本)。

返回结果:｛“code”;200,“data”: [ {"ckkcsj VOS"：[{"sjjd”:“2023-06-06 12:00:00”, "ckkcvos":[{cknm”:"01”,“xyl":50.0},{“cknm”: '02”,"xyl’:100.0},{"cknm”:"03”, "xyl”:200.0}]}]，“spnm”:“01”}]

ckkcsjVOS：用于封装某个商品在某个时间节点在各个仓库的储备情况
ckkcvos：封装仓库的储备情况
Sjjd:时间节点
cknm:仓库内码
xyl：现有量
CKKCVOS:仓库数据

---
接口名称:sptp/queryYscb

接口功能:查询从某仓库运输某货物到下订单

的公司的总调配成本（出库时间十运输成来+提收成本）

请求方式:POST	

请求参数:

String pnm 商品内码

String cknm 仓库内码

double jd 下订单公司的经度

double wd 下订单公司的纬度

double sl 商品数量

String lg 量纲(吨/个)


返回结果: ｛“code”：200，“date”: 36.0｝

此处data的值为double类型

单位为小时

---

计算返回结果数据结构
String cknm 仓库内码
String qynm 企业内码
String spnm 商品内码
Date xqsj 需求时间(从订单中取值)
double cb(用提供的查询总调配成本接口得到的值赋值)

请求参数


{

"Spdd":[

{

"ddnm":"订单内码"，

"qynm":"提交商品订单企业内码"，"spnm":"商品内码"，"sl":"商品数量"，"lg":"量纲"，

"zwdpwcsj":"最晚商品调配完成时间",

"ckdata":[{"cknm":"xx","pfwhnm":"xx","yscb":6.0},"cknm":"xx","pfwhnm":"xx","yscb":6.0}]｝//yscb只是仓库到订单的运输成本，总调配成本是运输成本加出库成本

]，

"spmzd":"商品满足度"，"dpsx":"调配顺序"｝

---
算法问题及需求转换

1. **需求一：** 避免遍历`spnm`。因为`spnm`字符串有特殊含义，不可拆分，需要设计算法保证`spnm`的完整性。
2. **需求二：** 在分配商品数量超过仓库余量的情况下，算法需要能自动从第二个仓库分配。
3. **需求三：** 考虑运输和出库成本。算法应包含运输和出库成本的计算逻辑。
4. **需求四：** 避免仓库时间冲突。如果算法计算出A订单在某个时间段在A仓库开始搬运商品，同时计算出B订单在A订单的搬运时间段内在A仓库开始搬运商品，此时算法应能识别订单冲突，并把A仓库视为对于B订单来说的不可用状态。
5. **需求五：** 维护仓库实时库存。因为计算过程中没有交互，所以每次查询到的库存值是一样的。算法需要自己维护实时库存，避免出现无限调配的情况。
6. **需求六：** 当库存不足时，需要按照可分配数量（而非需求量）计算成本。即，调用成本接口时应传递实际能分配的数据。

原来的算法问题描述：
>1：遍历spnm不对，spnm字符串是有特殊含义的，不可拆分
2：分配商品数量超过仓库余量，未从第二个仓库分配
3：有没有考虑运输和出库成本问题，代码中没有看到。（）
4： 仓库时间冲突：同时段只有一种货物。
假设计算出A订单在6月6日12：00在A仓库开始搬运商品，要搬运到18：00才能完成出库，同时计算出B订单在6月6日14：00在A仓库开始搬运商品，此时订单冲突，对于B订单来说A仓库是不可用状态开始搬运时间=最晚商品调配完成时间（输入中有）-总调配时间（queryYscb接口查询获取）
结束搬运时间=最晚商品调配完成时间（输入中有）-运输时间（getZytpcl接口中ckData.yscb）
假设计算出A订单在6月6日12：00在A仓库开始搬运商品，要搬运到18：00才能完成出库，同时计算出B订单在6月6日14：00在A仓库开始搬运商品(在A订单的搬运时间段内12：00-18：00)，此时订单冲突，对于B订单来说A仓库是不可用状态
## 系统需求

需要实现对仓库吞吐量的查询功能。
